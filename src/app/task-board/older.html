<div>
  Welcome to mStatus {{loginName}}!!
</div>
<div class="container main-wrapper">
  <div class="row justify-content-center" style="margin-bottom: 50px;">
    <div class="col-md-8">
      <div class="card">
        <form #editedValue="ngForm" (ngSubmit)="addTask(editedValue.value)">
          <div class="card-body">
            <div class="form-group row">
              <label for="staticEmail" class="col-sm-2 col-form-label">Assign To:</label>
              <div class="col-sm-10">
                <input type="text" class="form-control" id="assignValue" name="assignValue" (keydown)="getSuggestion($event)" value="{{assignName}}"
                  [(ngModel)]="assignName">
                <div *ngIf="flag == 1">
                  <div *ngFor="let name of names">
                    <small *ngIf="key_length?.length > 1" (click)="addAssignee(name)">{{name?.EmployeeName}}</small>
                  </div>
                </div>
              </div>
            </div>
            <div class="form-group row">
              <label for="inputPassword" class="col-sm-2 col-form-label">Title</label>
              <div class="col-sm-10">
                <input class="form-control" id="taskTitle" name="taskTitle" [(ngModel)]="taskTitle">
              </div>
            </div>
            <div class="form-group row">
              <label for="inputPassword" class="col-sm-2 col-form-label">Description</label>
              <div class="col-sm-10">
                <textarea class="form-control" id="taskDesc" rows="2" name="taskDesc" [(ngModel)]="taskDesc"></textarea>
              </div>
            </div>
            <div class="form-group row">
              <label for="inputPassword" class="col-sm-2 col-form-label">Watchers</label>
              <div class="col-sm-10">
                <ul class="list-group col-lg mb-1">
                  <li *ngFor="let watcher of watchers" class="d-flex">
                    <input type="text" class="form-control-plaintext" id="staticEmail" value={{watcher}} disabled>
                    <button type="button" class="close" (click)="deleteWatcher(watcher)">x</button>
                  </li>
                </ul>
                <input type="text" id="watcherValue" (keydown)="getSuggestion($event)" #watcher value="{{watcherName}}">
                <button type="button" (click)="addWatcher(watcher.value)">add</button>
                <div *ngIf="flag == 2">
                  <div *ngFor="let name of names">
                    <small *ngIf="key_length?.length > 1" (click)="setWatcher(name)">{{name?.EmployeeName}}</small>
                  </div>
                </div>
              </div>
            </div>
            <div class="form-group row">
              <label for="taskDuedate" class="col-sm-2 col-form-label">Due Date</label>
              <div class="col-sm-10 form-group">
                <input type="date" class="form-control" id="taskDuedate" name="taskDuedate" [(ngModel)]="taskDuedate">
              </div>
            </div>
          </div>
          <div class="card-footer">
            <button class="btn btn-primary" type="submit">Create Task</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          Assigned Tasks
          <input type="text" id="taskAssignValue" #task value="">
          <button type="button" (click)="fetchTasks(task.value)">Get Tasks</button>
        </div>
        <div *ngFor="let task of taskList">
          <div class="card-body" style="margin-left:5%">
            <div class="row">
              <div class=" row col-sm-7">
                <div>
                  <label class="my-0">Title:</label>
                </div>
                <span class="text-muted" style="padding:0px 4px">{{task?.title}}</span>
              </div>
              <div class="row col-sm-5">
                <div>
                  <label class="my-0">Status:</label>
                </div>
                <span class="text-muted" style="padding:0px 4px">{{task?.status}}</span>
              </div>
            </div>
            <div class="row">
              <div class="row col-sm">
                <div>
                  <label class="my-0">Description:</label>
                </div>
                <span class="text-muted" style="padding:0px 4px">{{task?.desc}}</span>
              </div>
            </div>
            <div class="row">
                <div class="row col-sm-5">
                  <div>
                    <label class="my-0">Progress:</label>
                  </div>
                  <span class="text-muted" style="padding:0px 4px">{{task?.completionPercent}}</span>
                </div>
              </div>
            <div class="row">
              <div class=" row col-sm-6">
                <div>
                  <label class="my-0">CreatedBy:</label>
                </div>
                <span class="text-muted" style="padding:0px 4px">{{task?.owner}}</span>
              </div>
              <button class="btn btn-success " (click)="showEditTaskForm(task)">Edit</button>
              <button class="btn btn-info " style="margin-left:5%" (click)="reAssign(task)">Reassign</button>
            </div>
            <form *ngIf="editTaskForm && task?._id == editedTask._id">
              <h6>Edit task details</h6>
              <br/>
              <p>Title:
                <input type="text" name="title" [(ngModel)]="editedTask.title" />
              </p>
              <p>Desc:
                <input type="text" name="desc" [(ngModel)]="editedTask.desc" />
              </p>
              <p>
                <button type="button" class="btn btn-primary" (click)="editTask(editedTask)">Update</button>
                <button type="button" class="btn btn-warning" (click)="cancelEdits()">Cancel</button>
              </p>
            </form>
            <hr/>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          Watching
        </div>
        <div *ngFor="let task of watchList">
          <div class="card-body" style="margin-left:5%">
            <div class="row">
              <div class=" row col-sm-7">
                <div>
                  <label class="my-0">Title:</label>
                </div>
                <span class="text-muted" style="padding:0px 4px">{{task?.title}}</span>
              </div>
              <div class="row col-sm-5">
                <div>
                  <label class="my-0">Status:</label>
                </div>
                <span class="text-muted" style="padding:0px 4px">{{task?.status}}</span>
              </div>
            </div>
            <div class="row">
              <div class="row col-sm-7">
                <div>
                  <label class="my-0">Progress:</label>
                </div>
                <span class="text-muted" style="padding:0px 4px">{{task?.completionPercent}}</span>
              </div>
            </div>
            <div class="row">
              <div class="row col-sm-7">
                <div>
                  <label class="my-0">Assignee:</label>
                </div>
                <span class="text-muted" style="padding:0px 4px">{{task?.assignedTo}}</span>
              </div>
            </div>
            <div class="row">
              <div class=" row col-sm-7">
                <div>
                  <label class="my-0">CreatedBy:</label>
                </div>
                <span class="text-muted" style="padding:0px 4px">{{task?.owner}}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
